<ion-header class="ion-no-border glass-effect">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-menu-button color="primary"></ion-menu-button>
    </ion-buttons>
    <ion-title class="text-gradient">MusicApp</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="toggleTheme()">
        <ion-icon slot="icon-only" name="color-palette-outline"></ion-icon>
      </ion-button>
      <ion-button (click)="logout()">
        <ion-icon slot="icon-only" name="log-out-outline" color="danger"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <div class="home-container">

    <!-- Welcome Header -->
    <header class="welcome-section animate-up">
      <div class="welcome-text">
        <p class="greeting">{{ greeting }}</p>
        <h1 class="user-name">Explora lo Nuevo</h1>
      </div>
      <ion-avatar class="user-avatar">
        <img src="https://i.pravatar.cc/150?u=music" alt="avatar" />
      </ion-avatar>
    </header>

    <!-- Popular Tracks Swiper -->
    <section class="section animate-up" style="animation-delay: 0.1s">
      <div class="section-header">
        <h2 class="section-title">Tracks Destacados</h2>
        <ion-button fill="clear" size="small">Ver todo</ion-button>
      </div>

      <swiper-container
        [slidesPerView]="1.2"
        [spaceBetween]="20"
        [centeredSlides]="false"
        class="popular-slider"
      >
        <swiper-slide *ngFor="let track of topTracks">
          <div class="track-card">

            <div class="card-image">
              <img [src]="track.album?.cover_medium" [alt]="track.title" />

              <!-- BOTÓN FAVORITO ❤️ -->
              <ion-button
                fill="clear"
                class="favorite-btn"
                (click)="toggleFavorite(track)"
              >
                <ion-icon
                  [name]="isFavorite(track.id) ? 'heart' : 'heart-outline'"
                  color="danger"
                ></ion-icon>
              </ion-button>

              <div class="play-overlay">
                <ion-icon name="play-circle-outline"></ion-icon>
              </div>
            </div>

            <div class="card-info">
              <h3>{{ track.title }}</h3>
              <p>{{ track.artist?.name }}</p>
            </div>

          </div>
        </swiper-slide>

        <div *ngIf="isLoading" class="loading-cards">
          <ion-skeleton-text
            animated
            style="width: 280px; height: 180px; border-radius: 20px;"
          ></ion-skeleton-text>
        </div>
      </swiper-container>
    </section>

    <!-- Top Albums Grid -->
    <section class="section animate-up" style="animation-delay: 0.2s">
      <div class="section-header">
        <h2 class="section-title">Álbumes Tendencia</h2>
      </div>

      <div class="albums-grid">
        <div class="album-item" *ngFor="let album of topAlbums?.slice(0, 6)">
          <div class="album-cover">
            <img [src]="album.cover_medium" [alt]="album.title" />
          </div>
          <div class="album-info">
            <h4>{{ album.title }}</h4>
            <p>{{ album.artist?.name }}</p>
          </div>
        </div>
      </div>
    </section>

    <!-- Quick Actions -->
    <section class="section quick-actions animate-up" style="animation-delay: 0.3s">
      <ion-button
        (click)="irAIntro()"
        expand="block"
        fill="outline"
        shape="round"
        color="medium"
      >
        <ion-icon name="refresh-outline" slot="start"></ion-icon>
        Reiniciar Tutorial
      </ion-button>
    </section>

    <!-- Loading State -->
    <div *ngIf="isLoading" class="ion-text-center padding-md">
      <ion-spinner name="crescent" color="primary"></ion-spinner>
    </div>

  </div>
</ion-content>
